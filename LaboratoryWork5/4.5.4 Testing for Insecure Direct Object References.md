# Тестування незахищених прямих посилань на об’єкти
|ID|
|----|
|WSTG-ATHZ-04|

## Резюме
Незахищені прямі посилання на об’єкти (IDOR) виникають, коли програма надає прямий доступ до об’єктів на основі введених користувачем даних. У результаті цієї вразливості зловмисники можуть обійти авторизацію та отримати прямий доступ до ресурсів у системі, наприклад, до записів бази даних або файлів. Незахищені прямі посилання на об’єкти дозволяють зловмисникам обходити авторизацію та отримувати прямий доступ до ресурсів, змінюючи значення параметра, який використовується для прямого вказування на об’єкт. Такими ресурсами можуть бути записи бази даних, що належать іншим користувачам, файли в системі тощо. Це викликано тим фактом, що програма приймає введені користувачем дані та використовує їх для отримання об’єкта, не виконуючи належних перевірок авторизації.

### Цілі тесту
Визначте точки, де можуть виникати посилання на об’єкти.
Оцініть заходи контролю доступу та чи є вони вразливими до IDOR.

### Як тестувати
Щоб перевірити цю вразливість, тестувальнику спочатку потрібно нанести на карту всі місця в додатку, де дані користувача використовуються для безпосереднього посилання на об’єкти. Наприклад, місця, де введення користувача використовується для доступу до рядка бази даних, файлу, сторінок програми тощо. Далі тестувальник повинен змінити значення параметра, який використовується для посилання на об’єкти, і оцінити, чи можливо отримати об’єкти, що належать іншим користувачам, або іншим чином обійти авторизацію.

Найкращим способом перевірки прямих посилань на об’єкти було б мати принаймні двох (часто більше) користувачів для охоплення різних об’єктів і функцій. Наприклад, два користувачі, кожен з яких має доступ до різних об’єктів (таких як інформація про покупки, приватні повідомлення тощо), і (якщо доречно) користувачі з різними привілеями (наприклад, адміністратори), щоб побачити, чи є прямі посилання на функціональні можливості програми. Маючи кількох користувачів, тестувальник економить дорогоцінний час тестування на вгадуванні різних назв об’єктів, оскільки він може спробувати отримати доступ до об’єктів, які належать іншому користувачеві.

Нижче наведено кілька типових сценаріїв цієї вразливості та методи перевірки для кожного з них.

### Значення параметра використовується безпосередньо для отримання запису бази даних
Зразок запиту:

http://foo.bar/somepage?invoice=12345
У цьому випадку значення параметра рахунка-фактури використовується як індекс у таблиці рахунків-фактур у базі даних. Програма приймає значення цього параметра та використовує його в запиті до бази даних. Потім програма повертає інформацію про рахунок-фактуру користувачеві.

Оскільки значення рахунку-фактури входить безпосередньо в запит, змінюючи значення параметра, можна отримати будь-який об’єкт рахунку-фактури, незалежно від користувача, якому належить рахунок-фактура. Щоб перевірити цей випадок, тестувальник повинен отримати ідентифікатор рахунку-фактури, що належить іншому тестовому користувачеві (переконавшись, що він не повинен переглядати цю інформацію відповідно до бізнес-логіки програми), а потім перевірити, чи можливий доступ до об’єктів без авторизації.

### Значення параметра використовується безпосередньо для виконання операції в системі
Зразок запиту:

http://foo.bar/changepassword?user=someuser
У цьому випадку значення параметра користувача використовується, щоб повідомити програмі, для якого користувача вона повинна змінити пароль. У багатьох випадках цей крок буде частиною майстра або багатоетапною операцією. На першому кроці програма отримає запит із зазначенням пароля якого користувача потрібно змінити, а на наступному кроці користувач надасть новий пароль (без запиту поточного).

Параметр користувача використовується для безпосереднього посилання на об'єкт користувача, для якого буде виконана операція зміни пароля. Щоб перевірити цей випадок, тестувальник повинен спробувати надати інше тестове ім’я користувача, відмінне від того, яке зараз увійшло, і перевірити, чи можна змінити пароль іншого користувача.

### Значення параметра використовується безпосередньо для отримання ресурсу файлової системи
Зразок запиту:

http://foo.bar/showImage?img=img00011
У цьому випадку значення параметра file використовується, щоб повідомити програмі, який файл користувач має намір отримати. Вказавши назву або ідентифікатор іншого файлу (наприклад, file=image00012.jpg), зловмисник зможе отримати об’єкти, що належать іншим користувачам.

Щоб перевірити цей випадок, тестувальник повинен отримати посилання, до якого користувач не повинен мати доступу, і спробувати отримати до нього доступ, використовуючи його як значення параметра файлу. Примітка. Цю вразливість часто використовують у поєднанні з уразливістю проходження каталогу/шляху (див. Тестування на проходження шляху)

### Значення параметра використовується безпосередньо для доступу до функцій програми
Зразок запиту:

http://foo.bar/accessPage?menuitem=12
У цьому випадку значення параметра menuitem використовується, щоб повідомити програмі, до якого пункту меню (і, отже, до якої функції програми) намагається отримати доступ користувач. Припустімо, що користувач має бути обмежений і тому має посилання, доступні лише для доступу до пунктів меню 1, 2 і 3. Змінивши значення
